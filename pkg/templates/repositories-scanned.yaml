# gz-git configuration (repositories format)
# Generated by: gz-git workspace init
# Scanned at: {{.ScannedAt}}
# Found: {{.Count}} repositories
#
# This format uses a flat repository list. For hierarchical workspaces,
# use: gz-git workspace init . --kind workspace

version: 1
kind: repositories

# Base path for relative repository paths (default: config file location)
basePath: {{.BasePath}}

{{- if .ExplainDefaults}}
# metadata:
#   name: my-project
#   type: development        # development, production, personal
#   owner: username
#   team: team-name
{{- end}}

# =============================================================================
# Default Settings
# These apply globally unless overridden at repository level.
# =============================================================================
defaults:
  # --- Clone settings ---
  clone:
    proto: {{.CloneProto}}              # ssh, https
{{- if .SSHPort}}
    sshPort: {{.SSHPort}}
{{- else if .ExplainDefaults}}
    # sshPort: 22             # Custom SSH port (for non-standard setups)
{{- end}}
{{- if .ExplainDefaults}}
    # sshKeyPath: ~/.ssh/id_rsa    # SSH private key file path
    # sshKeyContent: ${SSH_KEY}    # SSH key from env var (use for CI/CD)
{{- end}}

  # --- Sync settings ---
  sync:
    strategy: {{.Strategy}}             # reset (force), pull (safe), fetch (read-only), skip
    parallel: {{.Parallel}}             # Parallel workers for bulk operations
    maxRetries: {{.MaxRetries}}         # Retry count on failure
{{- if .ExplainDefaults}}
    # timeout: 60s            # Operation timeout (e.g., 30s, 1m, 5m)
{{- end}}

{{- if .ExplainDefaults}}
  # --- Scan settings ---
  # scan:
  #   depth: 2                # Default scan depth for bulk operations

  # --- Output settings ---
  # output:
  #   compact: true           # Omit redundant fields (path when equals name)
  #   format: default         # Output format: default, compact, json, llm

  # --- Filter settings ---
  # filter:
  #   include:                # Include repos matching these patterns (regex)
  #     - "^core-"
  #   exclude:                # Exclude repos matching these patterns
  #     - "archived-"
{{- end}}

# =============================================================================
# Self-Sync Configuration
# Sync the config directory (this directory) along with repositories.
# =============================================================================
selfSync:
  enabled: true
  strategy: pull                        # fetch (safe), pull (with dirty check)
{{- if .ExplainDefaults}}
  # Note: "reset" is NOT allowed for selfSync to prevent data loss.
  # If working tree is dirty, falls back to "fetch" automatically.
{{- end}}

{{- if .ExplainDefaults}}
# =============================================================================
# Branch Configuration (Optional)
# =============================================================================
# branch:
#   defaultBranch: develop,master       # Fallback list: tries in order
#   protectedBranches: [main, master, "release/*"]

# =============================================================================
# Hooks (Optional)
# Run commands before/after sync operations.
# =============================================================================
# hooks:
#   before:
#     - echo "Starting sync..."
#   after:
#     - echo "Sync complete!"

{{- end}}
# =============================================================================
# Repositories
# Simple flat list of git repositories.
# =============================================================================
repositories:
{{range .Repositories}}  - name: {{.Name}}
{{- if .Path}}
    path: {{.Path}}
{{- end}}
{{- if .Branch}}
    branch: {{.Branch}}
{{- else if $.ExplainDefaults}}
    # branch: main            # Override default branch
{{- end}}
{{- if .URL}}
    url: {{.URL}}
{{- else if $.ExplainDefaults}}
    # url: git@github.com:org/repo.git  # Clone URL (for new repos)
{{- end}}
{{- if .AdditionalRemotes}}
    additionalRemotes:
{{- range $name, $url := .AdditionalRemotes}}
      {{$name}}: {{$url}}
{{- end}}
{{- else if $.ExplainDefaults}}
    # additionalRemotes:      # Extra remotes to configure
    #   upstream: https://github.com/original/repo.git
{{- end}}
{{- if $.ExplainDefaults}}
    # --- Repository-level overrides ---
    # sync:
    #   strategy: pull        # Override default strategy
    # hooks:
    #   after:
    #     - make install
{{- end}}
{{end}}
