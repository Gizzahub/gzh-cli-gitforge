# Homebrew Tap Setup Guide

This guide explains how to set up Homebrew distribution for gz-git.

## Prerequisites

1. GitHub organization/user: `gizzahub`
1. GoReleaser configuration: `.goreleaser.yaml` (already created)
1. GitHub Actions workflow: `.github/workflows/release.yml` (already configured)

## Step 1: Create Homebrew Tap Repository

Create a new GitHub repository named `homebrew-tap`:

```bash
# Repository name must start with "homebrew-"
# URL: https://github.com/gizzahub/homebrew-tap
```

### Repository Structure

```
homebrew-tap/
├── README.md
├── Formula/
│   └── gz-git.rb    # Auto-generated by GoReleaser
└── .github/
    └── workflows/
        └── tests.yml  # Optional: test formulas
```

### Sample README.md for homebrew-tap

````markdown
# Homebrew Tap for gizzahub

## Installation

```bash
brew tap gizzahub/tap
brew install gz-git
````

## Available Formulas

| Formula | Description                        |
| ------- | ---------------------------------- |
| gz-git  | Git repository management CLI tool |

## Updating

```bash
brew update
brew upgrade gz-git
```

````

## Step 2: Create Personal Access Token (PAT)

1. Go to GitHub Settings > Developer settings > Personal access tokens > Tokens (classic)
2. Click "Generate new token (classic)"
3. Configure:
   - **Note**: `homebrew-tap-token`
   - **Expiration**: Set appropriate expiration
   - **Scopes**: Select `repo` (full control of private repositories)
4. Copy the generated token

## Step 3: Add Repository Secret

1. Go to `gzh-cli-gitforge` repository settings
2. Navigate to Secrets and variables > Actions
3. Click "New repository secret"
4. Configure:
   - **Name**: `HOMEBREW_TAP_TOKEN`
   - **Value**: Paste the PAT from Step 2

## Step 4: Release

When you push a new tag, GoReleaser will:

1. Build binaries for all platforms
2. Create GitHub release with assets
3. Auto-update the Homebrew formula in `homebrew-tap`

```bash
# Create and push a new tag
git tag v1.0.0
git push origin v1.0.0
````

## User Installation

After release, users can install via:

```bash
# Add tap and install
brew tap gizzahub/tap
brew install gz-git

# Or in one command
brew install gizzahub/tap/gz-git

# Verify installation
gz-git --version
```

## Updating Formula Manually (Optional)

If you need to update the formula manually:

```bash
# Clone tap repository
git clone https://github.com/gizzahub/homebrew-tap.git
cd homebrew-tap

# Edit formula
vim Formula/gz-git.rb

# Test locally
brew install --build-from-source Formula/gz-git.rb

# Commit and push
git add Formula/gz-git.rb
git commit -m "Update gz-git to vX.Y.Z"
git push
```

## Troubleshooting

### Token Permission Issues

If GoReleaser fails to push to homebrew-tap:

- Verify PAT has `repo` scope
- Ensure PAT is not expired
- Check `HOMEBREW_TAP_TOKEN` secret is correctly set

### Formula Validation

Test formula syntax locally:

```bash
brew audit --new Formula/gz-git.rb
brew style Formula/gz-git.rb
```

### Installation Issues

```bash
# Force reinstall
brew reinstall gz-git

# Check for conflicts
brew doctor

# View installation logs
brew install gz-git --verbose --debug
```

## References

- [GoReleaser Homebrew](https://goreleaser.com/customization/homebrew/)
- [Homebrew Formula Cookbook](https://docs.brew.sh/Formula-Cookbook)
- [Creating a Tap](https://docs.brew.sh/How-to-Create-and-Maintain-a-Tap)
